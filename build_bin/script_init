# set this to 1 see verbose output
_KAIROS_VERBOSE=${_KAIROS_VERBOSE:-0}

output() {
  if [ "${_KAIROS_VERBOSE}" -ne 0 ]; then
    echo $*
  else
    /bin/true
  fi
}

# A function to be installed as the error handler (call script_init to install)
error_hook() {
  echo "source: ${BASH_SOURCE[@]}"
  echo "lines:  ${BASH_LINENO[@]}"
  echo "funcs:  ${FUNCS[@]}"
  caller
  echo "at ${BASH_SOURCE[1]}:${BASH_LINENO[0]}"

}

# shortcut to exit with error and error message.
# Invoke with: error_exit <rc> <message>
#
# Note: this will not invoke the error handler
error_exit() {
  RC=$1
  MESSAGE=$2
  ERROR_SOURCE=${BASH_SOURCE[1]}:${BASH_LINENO[0]}
  echo "$MESSAGE (from $ERROR_SOURCE)" 1>&2
  exit $RC
}

trap error_hook ERR

echo "Kairos script init"
